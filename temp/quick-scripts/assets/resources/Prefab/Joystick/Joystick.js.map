{"version":3,"sources":["Joystick.js"],"names":["cc","Class","extends","Component","properties","Compass_Reset","default","displayName","tooltip","direction4or8","TurnStatic","type","EventHandler","turnUP","turnRIGHT","turnDOWN","turnLEFT","turnRIGHT_UP","turnRIGHT_DOWN","turnLEFT_DOWN","turnLEFT_UP","onLoad","Compass","node","Compass_parent","parent","center","getChildByName","opacity","Compass_initial_position","position","controlOFF","Canvas","find","UP","RIGHT_UP","RIGHT","RIGHT_DOWN","DOWN","LEFT_DOWN","LEFT","LEFT_UP","direction_tip_arr","Math_sqrt2","Math","sqrt","on","Node","EventType","TOUCH_START","event","newVec2","convertToNodeSpaceAR","getLocation","TOUCH_MOVE","move_8","move_4","TOUCH_END","v2","Tip_arr","emit","off","TOUCH_CANCEL","start","maxRadius","touchPos","pos","distance","mag","x","y","setPosition","abs","i","length"],"mappings":";;;;;;AAACA,GAAGC,KAAH,CAAS;AACNC,aAASF,GAAGG,SADN;;AAGNC,gBAAY;AACRC,uBAAe;AACXC,qBAAS,IADE;AAEXC,yBAAa,KAFF;AAGXC,qBAAS;AAHE,SADP;AAMRC,uBAAe;AACXH,qBAAS,IADE;AAEXC,yBAAa,OAFF;AAGXC,qBAAS;AAHE,SANP;AAWRE,oBAAY;AACRJ,qBAAS,IADD;AAERK,kBAAMX,GAAGG,SAAH,CAAaS,YAFX;AAGRL,yBAAa,UAHL;AAIRC,qBAAS;AAJD,SAXJ;AAiBRK,gBAAQ;AACJP,qBAAS,IADL;AAEJK,kBAAMX,GAAGG,SAAH,CAAaS,YAFf;AAGJL,yBAAa,SAHT;AAIJC,qBAAS;AAJL,SAjBA;AAuBRM,mBAAW;AACPR,qBAAS,IADF;AAEPK,kBAAMX,GAAGG,SAAH,CAAaS,YAFZ;AAGPL,yBAAa,SAHN;AAIPC,qBAAS;AAJF,SAvBH;AA6BRO,kBAAU;AACNT,qBAAS,IADH;AAENK,kBAAMX,GAAGG,SAAH,CAAaS,YAFb;AAGNL,yBAAa,SAHP;AAINC,qBAAS;AAJH,SA7BF;AAmCRQ,kBAAU;AACNV,qBAAS,IADH;AAENK,kBAAMX,GAAGG,SAAH,CAAaS,YAFb;AAGNL,yBAAa,SAHP;AAINC,qBAAS;AAJH,SAnCF;AAyCRS,sBAAc;AACVX,qBAAS,IADC;AAEVK,kBAAMX,GAAGG,SAAH,CAAaS,YAFT;AAGVL,yBAAa,UAHH;AAIVC,qBAAS;AAJC,SAzCN;AA+CRU,wBAAgB;AACZZ,qBAAS,IADG;AAEZK,kBAAMX,GAAGG,SAAH,CAAaS,YAFP;AAGZL,yBAAa,UAHD;AAIZC,qBAAS;AAJG,SA/CR;AAqDRW,uBAAe;AACXb,qBAAS,IADE;AAEXK,kBAAMX,GAAGG,SAAH,CAAaS,YAFR;AAGXL,yBAAa,UAHF;AAIXC,qBAAS;AAJE,SArDP;AA2DRY,qBAAa;AACTd,qBAAS,IADA;AAETK,kBAAMX,GAAGG,SAAH,CAAaS,YAFV;AAGTL,yBAAa,UAHJ;AAITC,qBAAS;AAJA;AA3DL,KAHN;;AAsENa,UAtEM,oBAsEG;AACL,aAAKC,OAAL,GAAe,KAAKC,IAApB;AACA,aAAKC,cAAL,GAAsB,KAAKF,OAAL,CAAaG,MAAnC;AACA,aAAKC,MAAL,GAAc,KAAKH,IAAL,CAAUI,cAAV,CAAyB,SAAzB,CAAd;AACA,YAAI,KAAKlB,aAAT,EAAwB;AACpB,iBAAKc,IAAL,CAAUI,cAAV,CAAyB,WAAzB,EAAsCC,OAAtC,GAAgD,GAAhD;AACA,iBAAKL,IAAL,CAAUI,cAAV,CAAyB,WAAzB,EAAsCC,OAAtC,GAAgD,CAAhD;AACH,SAHD,MAGO;AACH,iBAAKL,IAAL,CAAUI,cAAV,CAAyB,WAAzB,EAAsCC,OAAtC,GAAgD,CAAhD;AACA,iBAAKL,IAAL,CAAUI,cAAV,CAAyB,WAAzB,EAAsCC,OAAtC,GAAgD,GAAhD;AACH;AACD,aAAKC,wBAAL,GAAgC,KAAKP,OAAL,CAAaQ,QAA7C;AACA,aAAKC,UAAL,GAAkB,IAAlB;AACA,aAAKC,MAAL,GAAchC,GAAGiC,IAAH,CAAQ,QAAR,CAAd;AACA,aAAKC,EAAL,GAAU,KAAKX,IAAL,CAAUI,cAAV,CAAyB,IAAzB,CAAV;AACA,aAAKQ,QAAL,GAAgB,KAAKZ,IAAL,CAAUI,cAAV,CAAyB,UAAzB,CAAhB;AACA,aAAKS,KAAL,GAAa,KAAKb,IAAL,CAAUI,cAAV,CAAyB,OAAzB,CAAb;AACA,aAAKU,UAAL,GAAkB,KAAKd,IAAL,CAAUI,cAAV,CAAyB,YAAzB,CAAlB;AACA,aAAKW,IAAL,GAAY,KAAKf,IAAL,CAAUI,cAAV,CAAyB,MAAzB,CAAZ;AACA,aAAKY,SAAL,GAAiB,KAAKhB,IAAL,CAAUI,cAAV,CAAyB,WAAzB,CAAjB;AACA,aAAKa,IAAL,GAAY,KAAKjB,IAAL,CAAUI,cAAV,CAAyB,MAAzB,CAAZ;AACA,aAAKc,OAAL,GAAe,KAAKlB,IAAL,CAAUI,cAAV,CAAyB,SAAzB,CAAf;AACA,aAAKe,iBAAL,GAAyB,CAAC,KAAKR,EAAN,EAAU,KAAKC,QAAf,EAAyB,KAAKC,KAA9B,EAAqC,KAAKC,UAA1C,EAAsD,KAAKC,IAA3D,EAAiE,KAAKC,SAAtE,EAAiF,KAAKC,IAAtF,EAA4F,KAAKC,OAAjG,CAAzB;AACA,aAAKE,UAAL,GAAkBC,KAAKC,IAAL,CAAU,CAAV,CAAlB;AACA,YAAI,KAAKxC,aAAT,EAAwB;AACpB,iBAAK2B,MAAL,CAAYc,EAAZ,CAAe9C,GAAG+C,IAAH,CAAQC,SAAR,CAAkBC,WAAjC,EAA8C,UAAUC,KAAV,EAAiB;AAC3D,oBAAIC,UAAU,KAAK3B,cAAL,CAAoB4B,oBAApB,CAAyCF,MAAMG,WAAN,EAAzC,CAAd;AACA,qBAAK/B,OAAL,CAAaQ,QAAb,GAAwBqB,OAAxB;AACA,oBAAI,KAAK1C,aAAT,EAAwB;AACpB,yBAAKuB,MAAL,CAAYc,EAAZ,CAAe9C,GAAG+C,IAAH,CAAQC,SAAR,CAAkBM,UAAjC,EAA6C,KAAKC,MAAlD,EAA0D,IAA1D;AACH,iBAFD,MAEO;AACH,yBAAKvB,MAAL,CAAYc,EAAZ,CAAe9C,GAAG+C,IAAH,CAAQC,SAAR,CAAkBM,UAAjC,EAA6C,KAAKE,MAAlD,EAA0D,IAA1D;AACH;AACJ,aARD,EAQG,IARH;AASA,iBAAKxB,MAAL,CAAYc,EAAZ,CAAe9C,GAAG+C,IAAH,CAAQC,SAAR,CAAkBS,SAAjC,EAA4C,YAAY;AACpD,qBAAKnC,OAAL,CAAaQ,QAAb,GAAwB,KAAKD,wBAA7B;AACA,qBAAKH,MAAL,CAAYI,QAAZ,GAAuB9B,GAAG0D,EAAH,CAAM,CAAN,EAAS,CAAT,CAAvB;AACA,qBAAKC,OAAL;AACA;AACA,qBAAKjD,UAAL,CAAgBkD,IAAhB;AACA,oBAAI,KAAKnD,aAAT,EAAwB;AACpB,yBAAKuB,MAAL,CAAY6B,GAAZ,CAAgB7D,GAAG+C,IAAH,CAAQC,SAAR,CAAkBM,UAAlC,EAA8C,KAAKC,MAAnD,EAA2D,IAA3D;AACH,iBAFD,MAEO;AACH,yBAAKvB,MAAL,CAAY6B,GAAZ,CAAgB7D,GAAG+C,IAAH,CAAQC,SAAR,CAAkBM,UAAlC,EAA8C,KAAKE,MAAnD,EAA2D,IAA3D;AACH;AACJ,aAXD,EAWG,IAXH;AAYA,iBAAKxB,MAAL,CAAYc,EAAZ,CAAe9C,GAAG+C,IAAH,CAAQC,SAAR,CAAkBc,YAAjC,EAA+C,YAAY;AACvD,qBAAKxC,OAAL,CAAaQ,QAAb,GAAwB,KAAKD,wBAA7B;AACA,qBAAKH,MAAL,CAAYI,QAAZ,GAAuB9B,GAAG0D,EAAH,CAAM,CAAN,EAAS,CAAT,CAAvB;AACA,qBAAKC,OAAL;AACA;AACA,qBAAKjD,UAAL,CAAgBkD,IAAhB;AACA,oBAAI,KAAKnD,aAAT,EAAwB;AACpB,yBAAKuB,MAAL,CAAY6B,GAAZ,CAAgB7D,GAAG+C,IAAH,CAAQC,SAAR,CAAkBM,UAAlC,EAA8C,KAAKC,MAAnD,EAA2D,IAA3D;AACH,iBAFD,MAEO;AACH,yBAAKvB,MAAL,CAAY6B,GAAZ,CAAgB7D,GAAG+C,IAAH,CAAQC,SAAR,CAAkBM,UAAlC,EAA8C,KAAKE,MAAnD,EAA2D,IAA3D;AACH;AACJ,aAXD,EAWG,IAXH;AAYH,SAlCD,MAkCO;AACH,iBAAKlC,OAAL,CAAawB,EAAb,CAAgB9C,GAAG+C,IAAH,CAAQC,SAAR,CAAkBC,WAAlC,EAA+C,YAAY;AACvD,oBAAI,KAAKxC,aAAT,EAAwB;AACpB,yBAAKuB,MAAL,CAAYc,EAAZ,CAAe9C,GAAG+C,IAAH,CAAQC,SAAR,CAAkBM,UAAjC,EAA6C,KAAKC,MAAlD,EAA0D,IAA1D;AACH,iBAFD,MAEO;AACH,yBAAKvB,MAAL,CAAYc,EAAZ,CAAe9C,GAAG+C,IAAH,CAAQC,SAAR,CAAkBM,UAAjC,EAA6C,KAAKE,MAAlD,EAA0D,IAA1D;AACH;AACJ,aAND,EAMG,IANH;AAOA,iBAAKlC,OAAL,CAAawB,EAAb,CAAgB9C,GAAG+C,IAAH,CAAQC,SAAR,CAAkBS,SAAlC,EAA6C,YAAY;AACrD,qBAAK/B,MAAL,CAAYI,QAAZ,GAAuB9B,GAAG0D,EAAH,CAAM,CAAN,EAAS,CAAT,CAAvB;AACA,qBAAKC,OAAL;AACA;AACA,qBAAKjD,UAAL,CAAgBkD,IAAhB;AACA,oBAAI,KAAKnD,aAAT,EAAwB;AACpB,yBAAKuB,MAAL,CAAY6B,GAAZ,CAAgB7D,GAAG+C,IAAH,CAAQC,SAAR,CAAkBM,UAAlC,EAA8C,KAAKC,MAAnD,EAA2D,IAA3D;AACH,iBAFD,MAEO;AACH,yBAAKvB,MAAL,CAAY6B,GAAZ,CAAgB7D,GAAG+C,IAAH,CAAQC,SAAR,CAAkBM,UAAlC,EAA8C,KAAKE,MAAnD,EAA2D,IAA3D;AACH;AACJ,aAVD,EAUG,IAVH;AAWA,iBAAKlC,OAAL,CAAawB,EAAb,CAAgB9C,GAAG+C,IAAH,CAAQC,SAAR,CAAkBc,YAAlC,EAAgD,YAAY;AACxD,qBAAKpC,MAAL,CAAYI,QAAZ,GAAuB9B,GAAG0D,EAAH,CAAM,CAAN,EAAS,CAAT,CAAvB;AACA,qBAAKC,OAAL;AACA;AACA,qBAAKjD,UAAL,CAAgBkD,IAAhB;AACA,oBAAI,KAAKnD,aAAT,EAAwB;AACpB,yBAAKuB,MAAL,CAAY6B,GAAZ,CAAgB7D,GAAG+C,IAAH,CAAQC,SAAR,CAAkBM,UAAlC,EAA8C,KAAKC,MAAnD,EAA2D,IAA3D;AACH,iBAFD,MAEO;AACH,yBAAKvB,MAAL,CAAY6B,GAAZ,CAAgB7D,GAAG+C,IAAH,CAAQC,SAAR,CAAkBM,UAAlC,EAA8C,KAAKE,MAAnD,EAA2D,IAA3D;AACH;AACJ,aAVD,EAUG,IAVH;AAWH;AAEJ,KAhKK;AAkKNO,SAlKM,mBAkKE,CAEP,CApKK;;;AAsKNR,YAAQ,gBAAUL,KAAV,EAAiB;AACrB,YAAIc,YAAY,GAAhB;AACA,YAAIC,WAAWf,MAAMG,WAAN,EAAf;AACA,YAAIa,MAAM,KAAK5C,OAAL,CAAa8B,oBAAb,CAAkCa,QAAlC,CAAV;AACA,YAAIE,WAAWD,IAAIE,GAAJ,EAAf;AACA,YAAID,WAAWH,SAAf,EAA0B;AACtBE,gBAAIG,CAAJ,GAAQL,YAAYE,IAAIG,CAAhB,GAAoBF,QAA5B;AACAD,gBAAII,CAAJ,GAAQN,YAAYE,IAAII,CAAhB,GAAoBH,QAA5B;AACH;AACD,YAAI,KAAKpC,UAAT,EAAqB;AACjB,iBAAKL,MAAL,CAAY6C,WAAZ,CAAwBL,GAAxB;AACA,gBAAIC,WAAW,EAAf,EAAmB;AACf,oBAAI,KAAKzC,MAAL,CAAY4C,CAAZ,GAAgB,CAAhB,IAAqB1B,KAAK4B,GAAL,CAAS,KAAK9C,MAAL,CAAY2C,CAAZ,GAAgB,KAAK3C,MAAL,CAAY4C,CAArC,KAA2C,KAAK,IAAI,KAAK3B,UAAd,CAApE,EAA+F;AAC3F,yBAAKgB,OAAL,CAAa,KAAKzB,EAAlB;AACA,yBAAKrB,MAAL,CAAY+C,IAAZ;AACH;AACD,oBAAI,KAAKlC,MAAL,CAAY2C,CAAZ,GAAgB,CAAhB,IAAqB,KAAK3C,MAAL,CAAY4C,CAAZ,GAAgB,CAArC,IAA0C1B,KAAK4B,GAAL,CAAS,KAAK9C,MAAL,CAAY2C,CAAZ,GAAgB,KAAK3C,MAAL,CAAY4C,CAArC,IAA2C,IAAI,KAAK3B,UAA9F,IAA6GC,KAAK4B,GAAL,CAAS,KAAK9C,MAAL,CAAY2C,CAAZ,GAAgB,KAAK3C,MAAL,CAAY4C,CAArC,KAA2C,KAAK,IAAI,KAAK3B,UAAd,CAA5J,EAAuL;AACnL,yBAAKgB,OAAL,CAAa,KAAKxB,QAAlB;AACA,yBAAKlB,YAAL,CAAkB2C,IAAlB;AACA;AACH;AACD,oBAAI,KAAKlC,MAAL,CAAY2C,CAAZ,GAAgB,CAAhB,IAAqBzB,KAAK4B,GAAL,CAAS,KAAK9C,MAAL,CAAY2C,CAAZ,GAAgB,KAAK3C,MAAL,CAAY4C,CAArC,KAA4C,IAAI,KAAK3B,UAA9E,EAA2F;AACvF,yBAAKgB,OAAL,CAAa,KAAKvB,KAAlB;AACA,yBAAKtB,SAAL,CAAe8C,IAAf;AACA;AACH;AACD,oBAAI,KAAKlC,MAAL,CAAY2C,CAAZ,GAAgB,CAAhB,IAAqB,KAAK3C,MAAL,CAAY4C,CAAZ,GAAgB,CAArC,IAA0C1B,KAAK4B,GAAL,CAAS,KAAK9C,MAAL,CAAY2C,CAAZ,GAAgB,KAAK3C,MAAL,CAAY4C,CAArC,IAA2C,IAAI,KAAK3B,UAA9F,IAA6GC,KAAK4B,GAAL,CAAS,KAAK9C,MAAL,CAAY2C,CAAZ,GAAgB,KAAK3C,MAAL,CAAY4C,CAArC,KAA2C,KAAK,IAAI,KAAK3B,UAAd,CAA5J,EAAuL;AACnL,yBAAKgB,OAAL,CAAa,KAAKtB,UAAlB;AACA,yBAAKnB,cAAL,CAAoB0C,IAApB;AACA;AACH;AACD,oBAAI,KAAKlC,MAAL,CAAY4C,CAAZ,GAAgB,CAAhB,IAAqB1B,KAAK4B,GAAL,CAAS,KAAK9C,MAAL,CAAY2C,CAAZ,GAAgB,KAAK3C,MAAL,CAAY4C,CAArC,KAA2C,KAAK,IAAI,KAAK3B,UAAd,CAApE,EAA+F;AAC3F,yBAAKgB,OAAL,CAAa,KAAKrB,IAAlB;AACA,yBAAKvB,QAAL,CAAc6C,IAAd;AACA;AACH;AACD,oBAAI,KAAKlC,MAAL,CAAY2C,CAAZ,GAAgB,CAAhB,IAAqB,KAAK3C,MAAL,CAAY4C,CAAZ,GAAgB,CAArC,IAA0C1B,KAAK4B,GAAL,CAAS,KAAK9C,MAAL,CAAY2C,CAAZ,GAAgB,KAAK3C,MAAL,CAAY4C,CAArC,IAA2C,IAAI,KAAK3B,UAA9F,IAA6GC,KAAK4B,GAAL,CAAS,KAAK9C,MAAL,CAAY2C,CAAZ,GAAgB,KAAK3C,MAAL,CAAY4C,CAArC,KAA2C,KAAK,IAAI,KAAK3B,UAAd,CAA5J,EAAuL;AACnL,yBAAKgB,OAAL,CAAa,KAAKpB,SAAlB;AACA,yBAAKpB,aAAL,CAAmByC,IAAnB;AACA;AACH;AACD,oBAAI,KAAKlC,MAAL,CAAY2C,CAAZ,GAAgB,CAAhB,IAAqBzB,KAAK4B,GAAL,CAAS,KAAK9C,MAAL,CAAY2C,CAAZ,GAAgB,KAAK3C,MAAL,CAAY4C,CAArC,KAA4C,IAAI,KAAK3B,UAA9E,EAA2F;AACvF,yBAAKgB,OAAL,CAAa,KAAKnB,IAAlB;AACA,yBAAKxB,QAAL,CAAc4C,IAAd;AACA;AACH;AACD,oBAAI,KAAKlC,MAAL,CAAY2C,CAAZ,GAAgB,CAAhB,IAAqB,KAAK3C,MAAL,CAAY4C,CAAZ,GAAgB,CAArC,IAA0C1B,KAAK4B,GAAL,CAAS,KAAK9C,MAAL,CAAY2C,CAAZ,GAAgB,KAAK3C,MAAL,CAAY4C,CAArC,IAA2C,IAAI,KAAK3B,UAA9F,IAA6GC,KAAK4B,GAAL,CAAS,KAAK9C,MAAL,CAAY2C,CAAZ,GAAgB,KAAK3C,MAAL,CAAY4C,CAArC,KAA2C,KAAK,IAAI,KAAK3B,UAAd,CAA5J,EAAuL;AACnL,yBAAKgB,OAAL,CAAa,KAAKlB,OAAlB;AACA,yBAAKrB,WAAL,CAAiBwC,IAAjB;AACA;AACH;AACJ;AACJ;AACJ,KA3NK;AA4NNJ,YAAQ,gBAAUN,KAAV,EAAiB;AACrB,YAAIc,YAAY,GAAhB;AACA,YAAIC,WAAWf,MAAMG,WAAN,EAAf;AACA,YAAIa,MAAM,KAAK5C,OAAL,CAAa8B,oBAAb,CAAkCa,QAAlC,CAAV;AACA,YAAIE,WAAWD,IAAIE,GAAJ,EAAf;AACA,YAAID,WAAWH,SAAf,EAA0B;AACtBE,gBAAIG,CAAJ,GAAQL,YAAYE,IAAIG,CAAhB,GAAoBF,QAA5B;AACAD,gBAAII,CAAJ,GAAQN,YAAYE,IAAII,CAAhB,GAAoBH,QAA5B;AACH;AACD,YAAI,KAAKpC,UAAT,EAAqB;AACjB,iBAAKL,MAAL,CAAY6C,WAAZ,CAAwBL,GAAxB;AACA,gBAAIC,WAAW,EAAf,EAAmB;AACf,oBAAI,KAAKzC,MAAL,CAAY4C,CAAZ,GAAgB,CAAhB,IAAqB1B,KAAK4B,GAAL,CAAS,KAAK9C,MAAL,CAAY2C,CAAZ,GAAgB,KAAK3C,MAAL,CAAY4C,CAArC,KAA2C,CAApE,EAAuE;AACnE,yBAAKX,OAAL,CAAa,KAAKzB,EAAlB;AACA,yBAAKrB,MAAL,CAAY+C,IAAZ;AACA;AACH;AACD,oBAAI,KAAKlC,MAAL,CAAY2C,CAAZ,GAAgB,CAAhB,IAAqBzB,KAAK4B,GAAL,CAAS,KAAK9C,MAAL,CAAY2C,CAAZ,GAAgB,KAAK3C,MAAL,CAAY4C,CAArC,IAA0C,CAAnE,EAAsE;AAClE,yBAAKX,OAAL,CAAa,KAAKvB,KAAlB;AACA,yBAAKtB,SAAL,CAAe8C,IAAf;AACA;AACH;AACD,oBAAI,KAAKlC,MAAL,CAAY4C,CAAZ,GAAgB,CAAhB,IAAqB1B,KAAK4B,GAAL,CAAS,KAAK9C,MAAL,CAAY2C,CAAZ,GAAgB,KAAK3C,MAAL,CAAY4C,CAArC,KAA2C,CAApE,EAAuE;AACnE,yBAAKX,OAAL,CAAa,KAAKrB,IAAlB;AACA,yBAAKvB,QAAL,CAAc6C,IAAd;AACA;AACH;AACD,oBAAI,KAAKlC,MAAL,CAAY2C,CAAZ,GAAgB,CAAhB,IAAqBzB,KAAK4B,GAAL,CAAS,KAAK9C,MAAL,CAAY2C,CAAZ,GAAgB,KAAK3C,MAAL,CAAY4C,CAArC,IAA0C,CAAnE,EAAsE;AAClE,yBAAKX,OAAL,CAAa,KAAKnB,IAAlB;AACA,yBAAKxB,QAAL,CAAc4C,IAAd;AACA;AACH;AACJ;AACJ;AACJ,KA9PK;AA+PND,WA/PM,mBA+PEZ,IA/PF,EA+PQ;AACV,aAAK,IAAI0B,IAAI,CAAb,EAAgBA,IAAI,KAAK/B,iBAAL,CAAuBgC,MAA3C,EAAmDD,GAAnD,EAAwD;AACpD,iBAAK/B,iBAAL,CAAuB+B,CAAvB,EAA0B7C,OAA1B,GAAoC,CAApC;AACA,gBAAI6C,KAAK,KAAK/B,iBAAL,CAAuBgC,MAAvB,GAAgC,CAArC,IAA0C3B,IAA9C,EAAoD;AAChDA,qBAAKnB,OAAL,GAAe,GAAf;AACA;AACH;AACJ;AACJ;AAvQK;AAwQN;AAxQH","file":"Joystick.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\resources\\Prefab\\Joystick","sourcesContent":["﻿cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        Compass_Reset: {\r\n            default: true,\r\n            displayName: \"重定位\",\r\n            tooltip: '是否允许罗盘重定位'\r\n        },\r\n        direction4or8: {\r\n            default: true,\r\n            displayName: \"开启8方向\",\r\n            tooltip: '4方向和8方向切换，4方向下，组件目标指向可只设置：上-下-左-右'\r\n        },\r\n        TurnStatic: {\r\n            default: null,\r\n            type: cc.Component.EventHandler,\r\n            displayName: \"组件接口（静止）\",\r\n            tooltip: '控制的功能对象目标（静止状态），CustomEventData 请留空'\r\n        },\r\n        turnUP: {\r\n            default: null,\r\n            type: cc.Component.EventHandler,\r\n            displayName: \"组件接口（上）\",\r\n            tooltip: '控制的功能对象目标（上），CustomEventData 请留空'\r\n        },\r\n        turnRIGHT: {\r\n            default: null,\r\n            type: cc.Component.EventHandler,\r\n            displayName: \"组件接口（右）\",\r\n            tooltip: '控制的功能对象目标（右），CustomEventData 请留空'\r\n        },\r\n        turnDOWN: {\r\n            default: null,\r\n            type: cc.Component.EventHandler,\r\n            displayName: \"组件接口（下）\",\r\n            tooltip: '控制的功能对象目标（下），CustomEventData 请留空'\r\n        },\r\n        turnLEFT: {\r\n            default: null,\r\n            type: cc.Component.EventHandler,\r\n            displayName: \"组件接口（左）\",\r\n            tooltip: '控制的功能对象目标（左），CustomEventData 请留空'\r\n        },\r\n        turnRIGHT_UP: {\r\n            default: null,\r\n            type: cc.Component.EventHandler,\r\n            displayName: \"组件接口（右上）\",\r\n            tooltip: '控制的功能对象目标（右上），CustomEventData 请留空'\r\n        },\r\n        turnRIGHT_DOWN: {\r\n            default: null,\r\n            type: cc.Component.EventHandler,\r\n            displayName: \"组件接口（右下）\",\r\n            tooltip: '控制的功能对象目标（右下），CustomEventData 请留空'\r\n        },\r\n        turnLEFT_DOWN: {\r\n            default: null,\r\n            type: cc.Component.EventHandler,\r\n            displayName: \"组件接口（左下）\",\r\n            tooltip: '控制的功能对象目标（左下），CustomEventData 请留空'\r\n        },\r\n        turnLEFT_UP: {\r\n            default: null,\r\n            type: cc.Component.EventHandler,\r\n            displayName: \"组件接口（左上）\",\r\n            tooltip: '控制的功能对象目标（左上），CustomEventData 请留空'\r\n        }\r\n    },\r\n\r\n    onLoad() {\r\n        this.Compass = this.node;\r\n        this.Compass_parent = this.Compass.parent;\r\n        this.center = this.node.getChildByName('wheel-3');\r\n        if (this.direction4or8) {\r\n            this.node.getChildByName('wheel-1-1').opacity = 255;\r\n            this.node.getChildByName('wheel-1-2').opacity = 0;\r\n        } else {\r\n            this.node.getChildByName('wheel-1-1').opacity = 0;\r\n            this.node.getChildByName('wheel-1-2').opacity = 255;\r\n        };\r\n        this.Compass_initial_position = this.Compass.position;\r\n        this.controlOFF = true;\r\n        this.Canvas = cc.find('Canvas');\r\n        this.UP = this.node.getChildByName('UP');\r\n        this.RIGHT_UP = this.node.getChildByName('RIGHT_UP');\r\n        this.RIGHT = this.node.getChildByName('RIGHT');\r\n        this.RIGHT_DOWN = this.node.getChildByName('RIGHT_DOWN');\r\n        this.DOWN = this.node.getChildByName('DOWN');\r\n        this.LEFT_DOWN = this.node.getChildByName('LEFT_DOWN');\r\n        this.LEFT = this.node.getChildByName('LEFT');\r\n        this.LEFT_UP = this.node.getChildByName('LEFT_UP');\r\n        this.direction_tip_arr = [this.UP, this.RIGHT_UP, this.RIGHT, this.RIGHT_DOWN, this.DOWN, this.LEFT_DOWN, this.LEFT, this.LEFT_UP];\r\n        this.Math_sqrt2 = Math.sqrt(2);\r\n        if (this.Compass_Reset) {\r\n            this.Canvas.on(cc.Node.EventType.TOUCH_START, function (event) {\r\n                let newVec2 = this.Compass_parent.convertToNodeSpaceAR(event.getLocation());\r\n                this.Compass.position = newVec2;\r\n                if (this.direction4or8) {\r\n                    this.Canvas.on(cc.Node.EventType.TOUCH_MOVE, this.move_8, this);\r\n                } else {\r\n                    this.Canvas.on(cc.Node.EventType.TOUCH_MOVE, this.move_4, this);\r\n                }\r\n            }, this);\r\n            this.Canvas.on(cc.Node.EventType.TOUCH_END, function () {\r\n                this.Compass.position = this.Compass_initial_position;\r\n                this.center.position = cc.v2(0, 0);\r\n                this.Tip_arr();\r\n                //触发静止状态属性\r\n                this.TurnStatic.emit();\r\n                if (this.direction4or8) {\r\n                    this.Canvas.off(cc.Node.EventType.TOUCH_MOVE, this.move_8, this);\r\n                } else {\r\n                    this.Canvas.off(cc.Node.EventType.TOUCH_MOVE, this.move_4, this);\r\n                }\r\n            }, this);\r\n            this.Canvas.on(cc.Node.EventType.TOUCH_CANCEL, function () {\r\n                this.Compass.position = this.Compass_initial_position;\r\n                this.center.position = cc.v2(0, 0);\r\n                this.Tip_arr();\r\n                //触发静止状态属性\r\n                this.TurnStatic.emit();\r\n                if (this.direction4or8) {\r\n                    this.Canvas.off(cc.Node.EventType.TOUCH_MOVE, this.move_8, this);\r\n                } else {\r\n                    this.Canvas.off(cc.Node.EventType.TOUCH_MOVE, this.move_4, this);\r\n                }\r\n            }, this);\r\n        } else {\r\n            this.Compass.on(cc.Node.EventType.TOUCH_START, function () {\r\n                if (this.direction4or8) {\r\n                    this.Canvas.on(cc.Node.EventType.TOUCH_MOVE, this.move_8, this);\r\n                } else {\r\n                    this.Canvas.on(cc.Node.EventType.TOUCH_MOVE, this.move_4, this);\r\n                }\r\n            }, this);\r\n            this.Compass.on(cc.Node.EventType.TOUCH_END, function () {\r\n                this.center.position = cc.v2(0, 0);\r\n                this.Tip_arr();\r\n                //触发静止状态属性\r\n                this.TurnStatic.emit();\r\n                if (this.direction4or8) {\r\n                    this.Canvas.off(cc.Node.EventType.TOUCH_MOVE, this.move_8, this);\r\n                } else {\r\n                    this.Canvas.off(cc.Node.EventType.TOUCH_MOVE, this.move_4, this);\r\n                }\r\n            }, this);\r\n            this.Compass.on(cc.Node.EventType.TOUCH_CANCEL, function () {\r\n                this.center.position = cc.v2(0, 0);\r\n                this.Tip_arr();\r\n                //触发静止状态属性\r\n                this.TurnStatic.emit();\r\n                if (this.direction4or8) {\r\n                    this.Canvas.off(cc.Node.EventType.TOUCH_MOVE, this.move_8, this);\r\n                } else {\r\n                    this.Canvas.off(cc.Node.EventType.TOUCH_MOVE, this.move_4, this);\r\n                }\r\n            }, this);\r\n        }\r\n\r\n    },\r\n\r\n    start() {\r\n\r\n    },\r\n\r\n    move_8: function (event) {\r\n        var maxRadius = 100;\r\n        let touchPos = event.getLocation();\r\n        var pos = this.Compass.convertToNodeSpaceAR(touchPos);\r\n        let distance = pos.mag();\r\n        if (distance > maxRadius) {\r\n            pos.x = maxRadius * pos.x / distance;\r\n            pos.y = maxRadius * pos.y / distance;\r\n        };\r\n        if (this.controlOFF) {\r\n            this.center.setPosition(pos);\r\n            if (distance > 40) {\r\n                if (this.center.y > 0 && Math.abs(this.center.x / this.center.y) <= 1 / (1 + this.Math_sqrt2)) {\r\n                    this.Tip_arr(this.UP);\r\n                    this.turnUP.emit();\r\n                }\r\n                if (this.center.x > 0 && this.center.y > 0 && Math.abs(this.center.x / this.center.y) < (1 + this.Math_sqrt2) && Math.abs(this.center.x / this.center.y) >= 1 / (1 + this.Math_sqrt2)) {\r\n                    this.Tip_arr(this.RIGHT_UP);\r\n                    this.turnRIGHT_UP.emit();\r\n                    //cc.log('右上');\r\n                }\r\n                if (this.center.x > 0 && Math.abs(this.center.x / this.center.y) >= (1 + this.Math_sqrt2)) {\r\n                    this.Tip_arr(this.RIGHT);\r\n                    this.turnRIGHT.emit();\r\n                    //cc.log('右');\r\n                }\r\n                if (this.center.x > 0 && this.center.y < 0 && Math.abs(this.center.x / this.center.y) < (1 + this.Math_sqrt2) && Math.abs(this.center.x / this.center.y) >= 1 / (1 + this.Math_sqrt2)) {\r\n                    this.Tip_arr(this.RIGHT_DOWN);\r\n                    this.turnRIGHT_DOWN.emit();\r\n                    //cc.log('右下');\r\n                }\r\n                if (this.center.y < 0 && Math.abs(this.center.x / this.center.y) <= 1 / (1 + this.Math_sqrt2)) {\r\n                    this.Tip_arr(this.DOWN);\r\n                    this.turnDOWN.emit();\r\n                    //cc.log('下');\r\n                }\r\n                if (this.center.x < 0 && this.center.y < 0 && Math.abs(this.center.x / this.center.y) < (1 + this.Math_sqrt2) && Math.abs(this.center.x / this.center.y) >= 1 / (1 + this.Math_sqrt2)) {\r\n                    this.Tip_arr(this.LEFT_DOWN);\r\n                    this.turnLEFT_DOWN.emit();\r\n                    //cc.log('左下');\r\n                }\r\n                if (this.center.x < 0 && Math.abs(this.center.x / this.center.y) >= (1 + this.Math_sqrt2)) {\r\n                    this.Tip_arr(this.LEFT);\r\n                    this.turnLEFT.emit();\r\n                    //cc.log('左');\r\n                }\r\n                if (this.center.x < 0 && this.center.y > 0 && Math.abs(this.center.x / this.center.y) < (1 + this.Math_sqrt2) && Math.abs(this.center.x / this.center.y) >= 1 / (1 + this.Math_sqrt2)) {\r\n                    this.Tip_arr(this.LEFT_UP);\r\n                    this.turnLEFT_UP.emit();\r\n                    //cc.log('左上');\r\n                }\r\n            }\r\n        };\r\n    },\r\n    move_4: function (event) {\r\n        var maxRadius = 100;\r\n        let touchPos = event.getLocation();\r\n        var pos = this.Compass.convertToNodeSpaceAR(touchPos);\r\n        let distance = pos.mag();\r\n        if (distance > maxRadius) {\r\n            pos.x = maxRadius * pos.x / distance;\r\n            pos.y = maxRadius * pos.y / distance;\r\n        };\r\n        if (this.controlOFF) {\r\n            this.center.setPosition(pos);\r\n            if (distance > 40) {\r\n                if (this.center.y > 0 && Math.abs(this.center.x / this.center.y) <= 1) {\r\n                    this.Tip_arr(this.UP);\r\n                    this.turnUP.emit();\r\n                    //cc.log('上');\r\n                }\r\n                if (this.center.x > 0 && Math.abs(this.center.x / this.center.y) > 1) {\r\n                    this.Tip_arr(this.RIGHT);\r\n                    this.turnRIGHT.emit();\r\n                    //cc.log('右');\r\n                }\r\n                if (this.center.y < 0 && Math.abs(this.center.x / this.center.y) <= 1) {\r\n                    this.Tip_arr(this.DOWN);\r\n                    this.turnDOWN.emit();\r\n                    //cc.log('下');\r\n                }\r\n                if (this.center.x < 0 && Math.abs(this.center.x / this.center.y) > 1) {\r\n                    this.Tip_arr(this.LEFT);\r\n                    this.turnLEFT.emit();\r\n                    //cc.log('左');\r\n                }\r\n            }\r\n        };\r\n    },\r\n    Tip_arr(Node) {\r\n        for (let i = 0; i < this.direction_tip_arr.length; i++) {\r\n            this.direction_tip_arr[i].opacity = 0;\r\n            if (i == this.direction_tip_arr.length - 1 && Node) {\r\n                Node.opacity = 255;\r\n                //cc.log('name:' + Node.name);\r\n            }\r\n        }\r\n    },\r\n    // update (dt) {},\r\n});\r\n"]}