{"version":3,"sources":["Save_Win.js"],"names":["cc","Class","extends","Component","properties","onLoad","Win","node","Archive_Win","getChildByName","Win_S","Win_S_Arr","Win_Initial_Position","v2","view","getVisibleSize","width","height","setPosition","Win_B_Off","Win_S_Off","start","re_start","New_Archive_news","find","getComponent","Save_List","Display_Content","Math","ceil","length","Archive_Item","i","children","destroy","Archive_Name","instantiate","Time","parent","Label","string","opacity","theY","floor","Choice_Archive_Item","event","customEventData","target","Open_Win_S","Value","Node","Close_Win","True_Win_S","log","Make_Save","JSON","parse","sys","localStorage","getItem","The_Value","Write_Current_Date","Cancel_Win_S","Delete_Save","Close_Win_S"],"mappings":"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","file":"Save_Win.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\BasicLibrary","sourcesContent":["﻿cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\r\n    },\r\n\r\n    onLoad() {\r\n        this.Win = this.node;\r\n        this.Archive_Win = this.node.getChildByName('Archive_Win');\r\n        this.Win_S = this.node.getChildByName('Win_S');\r\n        this.Win_S_Arr = [];\r\n        this.Win_Initial_Position = cc.v2(cc.view.getVisibleSize().width, cc.view.getVisibleSize().height);\r\n        this.node.setPosition(this.Win_Initial_Position);\r\n        this.Win_S.setPosition(this.Win_Initial_Position);\r\n        this.Win_B_Off = false;\r\n        this.Win_S_Off = false;\r\n    },\r\n\r\n    start() {\r\n\r\n    },\r\n\r\n    re_start() {\r\n        let New_Archive_news = cc.find('The_Data').getComponent('The_Data').Save_List;\r\n        this.Display_Content = this.Archive_Win.getChildByName('scrollview').getChildByName('view').getChildByName('content');\r\n        this.Display_Content.height = Math.ceil((New_Archive_news.length + 1) / 2) * 100;\r\n        this.Archive_Item = this.Display_Content.getChildByName('Archive_Item');\r\n        for (let i = 0; i < this.Display_Content.children.length; i++) {\r\n            if (i > 0) {\r\n                this.Display_Content.children[i].destroy();\r\n            }\r\n        };\r\n        //特殊修改 New_Archive_news.length + 1;\r\n        for (let i = 0; i < New_Archive_news.length + 1; i++) {\r\n            let node = null;\r\n            let Archive_Name = null;\r\n            if (i == New_Archive_news.length) {\r\n                node = this.Archive_Item;\r\n                Archive_Name = '新建存档';\r\n            } else {\r\n                node = cc.instantiate(this.Archive_Item);\r\n                Archive_Name = New_Archive_news[i].Time;\r\n            }\r\n            node.parent = this.Display_Content;\r\n            node.getChildByName('String').getComponent(cc.Label).string = Archive_Name;\r\n            node.getChildByName('Archive_Frame').opacity = 150;\r\n            node.opacity = 255;\r\n            if (i % 2 == 0) {\r\n                let theY = Math.floor(i / 2);\r\n                node.setPosition(-110, -40 + (-theY * 100));\r\n            } else {\r\n                let theY = Math.floor((i - 1) / 2);\r\n                node.setPosition(110, -40 + (-theY * 100));\r\n            }\r\n        };\r\n        this.node.setPosition(cc.v2(0, 0));\r\n    },\r\n    Choice_Archive_Item(event, customEventData) {\r\n        var node = event.target;\r\n        if (!this.Win_B_Off) {\r\n            for (let i = 0; i < node.parent.children.length; i++) {\r\n                node.parent.children[i].getChildByName('Archive_Frame').opacity = 150;\r\n            };\r\n            node.getChildByName('Archive_Frame').opacity = 255;\r\n            this.Open_Win_S(node.getChildByName('String').getComponent(cc.Label).string, node);\r\n        }\r\n    },\r\n    Open_Win_S(Value, Node) {\r\n        this.Win_B_Off = true;\r\n        this.Win_S_Off = false;\r\n        this.Win_S_Arr = [Value, Node];\r\n        this.Win_S.getChildByName('Tips_News').getComponent(cc.Label).string = '存档使用'; \r\n        if (this.Win_S_Arr[0] == '新建存档') {\r\n            this.Win_S.getChildByName('True').getChildByName('Background').getChildByName('Label').getComponent(cc.Label).string = '新建存档';\r\n            this.Win_S.getChildByName('False').getChildByName('Background').getChildByName('Label').getComponent(cc.Label).string = '取消';\r\n        } else {\r\n            this.Win_S.getChildByName('True').getChildByName('Background').getChildByName('Label').getComponent(cc.Label).string = '覆盖存档';\r\n            this.Win_S.getChildByName('False').getChildByName('Background').getChildByName('Label').getComponent(cc.Label).string = '删除存档';\r\n        };\r\n        this.Win_S.setPosition(cc.v2(0, 0));\r\n    },\r\n    Close_Win() {\r\n        if (!this.Win_B_Off) {\r\n            this.Win_B_Off = false;\r\n            this.Win_S_Off = false;\r\n            this.Win.setPosition(this.Win_Initial_Position);\r\n        }\r\n    },\r\n    True_Win_S() {\r\n        this.Win_B_Off = false;\r\n        this.Win_S_Off = false;\r\n        this.Win_S.setPosition(this.Win_Initial_Position);\r\n        //音效\r\n        //cc.find('Canvas/BGM/click3bgm').getComponent(cc.AudioSource).play();\r\n        if (this.Win_S_Arr[0] == '新建存档') {\r\n            cc.log('新建存档 Value:' + this.Win_S_Arr[0] + 'Node:' + this.Win_S_Arr[1]);\r\n            cc.find('The_Data').getComponent('The_Data').Make_Save();\r\n            this.re_start();\r\n        } else {\r\n            cc.log('Value:' + this.Win_S_Arr[0] + 'Node:' + this.Win_S_Arr[1]);\r\n            let Save_List = JSON.parse(cc.sys.localStorage.getItem('Save_List'));\r\n            let The_Value = 0;\r\n            for (let i = 0; i < Save_List.length; i++) {\r\n                if (Save_List[i].Time == this.Win_S_Arr[0]) {\r\n                    The_Value = i;\r\n                }\r\n            };\r\n            //获取新的存档时间\r\n            this.Win_S_Arr[1].getChildByName('String').getComponent(cc.Label).string = cc.find('The_Data').getComponent('The_Data').Write_Current_Date();\r\n            cc.find('The_Data').getComponent('The_Data').Make_Save(The_Value);\r\n            this.re_start();\r\n        };\r\n    },\r\n    Cancel_Win_S() {\r\n        this.Win_B_Off = false;\r\n        this.Win_S_Off = false;\r\n        this.Win_S.setPosition(this.Win_Initial_Position);\r\n        if (this.Win_S_Arr[0] != '新建存档') {\r\n            let Save_List = JSON.parse(cc.sys.localStorage.getItem('Save_List'));\r\n            let The_Value = 0;\r\n            for (let i = 0; i < Save_List.length; i++) {\r\n                if (Save_List[i].Time == this.Win_S_Arr[0]) {\r\n                    The_Value = i;\r\n                }\r\n            };\r\n            cc.find('The_Data').getComponent('The_Data').Delete_Save(The_Value);\r\n            this.re_start();\r\n        }\r\n    },\r\n    Close_Win_S() {\r\n        this.Win_B_Off = false;\r\n        this.Win_S_Off = false;\r\n        this.Win_S.setPosition(this.Win_Initial_Position);\r\n    }\r\n\r\n    // update (dt) {},\r\n});\r\n"]}